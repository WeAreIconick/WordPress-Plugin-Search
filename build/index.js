(()=>{"use strict";var s,e={961:()=>{const s=window.wp.blocks,e=window.wp.i18n,r=window.wp.blockEditor,l=window.wp.components,n=window.wp.element,a=window.wp.coreData,i=window.wp.data,o=window.ReactJSXRuntime,t=JSON.parse('{"UU":"telex/block-wordpress-plugin-search"}');(0,s.registerBlockType)(t.UU,{edit:function({attributes:s,setAttributes:t}){const{resultsPerPage:c,defaultSort:p,showFilters:d}=s,[h,u]=(0,n.useState)([]),[w,g]=(0,n.useState)(!0),[m,b]=(0,n.useState)(null),[x,v]=(0,n.useState)(!1),[j,_]=(0,n.useState)(null),[f,k]=(0,n.useState)(0),{restNonce:y}=(0,i.useSelect)(s=>{const{getCurrentUser:e}=s(a.store),r=e();return{restNonce:r?.meta?.rest_nonce||window.wpApiSettings?.nonce}},[]);(0,n.useEffect)(()=>{(async()=>{try{g(!0),b(null);const s=new URLSearchParams({action:"query_plugins",browse:"newest"===p?"new":"updated"===p?"updated":"popular",per_page:"6"}),e=await fetch(`/wp-json/wordpress-plugin-search/v1/query?${s}`,{headers:{"Content-Type":"application/json",...y&&{"X-WP-Nonce":y}}});if(!e.ok)throw new Error(`Failed to load plugins: ${e.status}`);{const s=await e.json();if(s.plugins&&Array.isArray(s.plugins)){const e=s.plugins.map(s=>{if(s.slug){s.screenshots=[];for(let e=1;e<=5;e++)s.screenshots.push({id:e,url:`https://ps.w.org/${s.slug}/assets/screenshot-${e}.png`});s.primaryScreenshot=s.screenshots[0]?.url}return s});u(e)}}}catch(s){console.error("Error loading preview data:",s),b(s.message),u([])}finally{g(!1)}})()},[y,p]);const N=[{label:(0,e.__)("Most Popular","wordpress-plugin-search-block-wp"),value:"popular"},{label:(0,e.__)("Recently Updated","wordpress-plugin-search-block-wp"),value:"updated"},{label:(0,e.__)("Newest","wordpress-plugin-search-block-wp"),value:"new"}],S=(s,e=0)=>{s.screenshots&&0!==s.screenshots.length&&(_(s),k(e),v(!0))},C=s=>{if(!j?.screenshots)return;let e=f+s;e<0?e=j.screenshots.length-1:e>=j.screenshots.length&&(e=0),k(e)},P=s=>s.screenshots&&0!==s.screenshots.length?(0,o.jsxs)("div",{className:"wps-screenshot-slider",children:[(0,o.jsx)("div",{className:"wps-main-screenshot",onClick:()=>S(s,0),style:{cursor:"zoom-in"},children:(0,o.jsx)("img",{src:s.primaryScreenshot,alt:`${s.name} screenshot`,loading:"lazy",onError:s=>{s.target.style.display="none",s.target.parentNode.innerHTML='<div class="wps-no-screenshot"><span class="dashicons dashicons-format-image"></span><span>No screenshots available</span></div>'}})}),(0,o.jsx)("div",{className:"wps-screenshot-thumbs",children:s.screenshots.slice(0,5).map((e,r)=>(0,o.jsx)("div",{className:"wps-screenshot-thumb "+(0===r?"active":""),onClick:()=>S(s,r),style:{cursor:"pointer"},children:(0,o.jsx)("img",{src:e.url,alt:`Screenshot ${e.id}`,loading:"lazy",onError:s=>{s.target.parentNode.style.display="none"}})},e.id))})]}):(0,o.jsxs)("div",{className:"wps-no-screenshot",children:[(0,o.jsx)("span",{className:"dashicons dashicons-format-image"}),(0,o.jsx)("span",{children:"No screenshots available"})]});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.InspectorControls,{children:(0,o.jsxs)(l.PanelBody,{title:(0,e.__)("Browse Settings","wordpress-plugin-search-block-wp"),initialOpen:!0,children:[(0,o.jsx)(l.SelectControl,{label:(0,e.__)("Default Sort Order","wordpress-plugin-search-block-wp"),value:p,options:N,onChange:s=>t({defaultSort:s}),help:(0,e.__)("Choose how plugins are sorted by default","wordpress-plugin-search-block-wp")}),(0,o.jsx)(l.SelectControl,{label:(0,e.__)("Results Per Page","wordpress-plugin-search-block-wp"),value:c,options:[{label:"12",value:12},{label:"24",value:24},{label:"48",value:48}],onChange:s=>t({resultsPerPage:parseInt(s)})}),(0,o.jsx)(l.ToggleControl,{label:(0,e.__)("Show Filters","wordpress-plugin-search-block-wp"),checked:d,onChange:s=>t({showFilters:s}),help:(0,e.__)("Display sorting and filtering options to users","wordpress-plugin-search-block-wp")})]})}),(0,o.jsxs)("div",{...(0,r.useBlockProps)({className:"wps-search-block"}),children:[(0,o.jsxs)("div",{className:"wps-search-block__header",children:[(0,o.jsx)("h2",{className:"wps-search-block__title",children:(0,e.__)("WordPress Plugin Directory","wordpress-plugin-search-block-wp")}),(0,o.jsx)("p",{className:"wps-search-block__description",children:(0,e.__)("Browse popular WordPress plugins from the official directory.","wordpress-plugin-search-block-wp")})]}),(0,o.jsx)("div",{className:"wps-search-block__controls",children:d&&(0,o.jsx)("div",{className:"wps-filter-controls",children:(0,o.jsxs)("div",{className:"wps-filter-row",children:[(0,o.jsxs)("div",{className:"wps-filter-item",children:[(0,o.jsx)("label",{children:(0,e.__)("Sort by","wordpress-plugin-search-block-wp")}),(0,o.jsx)("select",{disabled:!0,children:(0,o.jsx)("option",{children:N.find(s=>s.value===p)?.label||"Most Popular"})})]}),(0,o.jsxs)("div",{className:"wps-filter-item",children:[(0,o.jsx)("label",{children:(0,e.__)("Only with screenshots","wordpress-plugin-search-block-wp")}),(0,o.jsx)("input",{type:"checkbox",disabled:!0})]})]})})}),(0,o.jsxs)("div",{className:"wps-search-block__results",children:[m&&(0,o.jsxs)(l.Notice,{status:"error",isDismissible:!1,children:[(0,e.__)("Error loading plugins:","wordpress-plugin-search-block-wp")," ",m]}),w?(0,o.jsxs)("div",{className:"wps-loading",children:[(0,o.jsx)(l.Spinner,{}),(0,o.jsx)("p",{children:(0,e.__)("Loading plugin directory...","wordpress-plugin-search-block-wp")})]}):(0,o.jsx)("div",{className:"wps-plugin-grid",children:h.length>0?h.map((s,e)=>{if(!s||!s.name)return null;const r=s.rating?Math.round(s.rating/20):0,l="★".repeat(r)+"☆".repeat(5-r);return(0,o.jsxs)("div",{className:"wps-plugin-item",children:[P(s),(0,o.jsxs)("div",{className:"wps-plugin-info",children:[(0,o.jsx)("h3",{className:"wps-plugin-title",children:s.name}),(0,o.jsxs)("div",{className:"wps-plugin-meta",children:[s.rating&&(0,o.jsxs)("div",{className:"wps-plugin-rating",children:[(0,o.jsx)("span",{className:"wps-rating-stars",children:l}),(0,o.jsxs)("span",{className:"wps-rating-text",children:["(",s.num_ratings||0,")"]})]}),s.active_installs&&(0,o.jsxs)("div",{className:"wps-plugin-installs",children:[s.active_installs.toLocaleString(),"+ installs"]})]})]})]},s.slug||e)}):(0,o.jsx)("p",{className:"wps-no-results",children:(0,e.__)("No plugins to display. This is a preview in the editor.","wordpress-plugin-search-block-wp")})})]}),(0,o.jsx)("div",{className:"wps-search-block__footer",children:(0,o.jsx)("p",{className:"wps-editor-note",children:(0,e.__)("This is an editor preview. Full browsing, sorting, filtering, and screenshot viewing will work on the front end.","wordpress-plugin-search-block-wp")})})]}),x&&j&&(0,o.jsx)(l.Modal,{title:j.name,onRequestClose:()=>{v(!1),_(null),k(0)},isFullScreen:!1,size:"large",className:"wps-screenshot-modal",children:(0,o.jsxs)("div",{style:{padding:"1rem",textAlign:"center"},children:[j.screenshots&&j.screenshots[f]&&(0,o.jsx)("img",{src:j.screenshots[f].url,alt:`${j.name} screenshot ${f+1}`,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}),j.screenshots&&j.screenshots.length>1&&(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"1rem",padding:"0 1rem"},children:[(0,o.jsx)(l.Button,{isSecondary:!0,onClick:()=>C(-1),disabled:0===f,children:(0,e.__)("Previous","wordpress-plugin-search-block-wp")}),(0,o.jsxs)("span",{style:{color:"#666",fontSize:"0.9rem"},children:[f+1," /"," ",j.screenshots.length]}),(0,o.jsx)(l.Button,{isSecondary:!0,onClick:()=>C(1),disabled:f===j.screenshots.length-1,children:(0,e.__)("Next","wordpress-plugin-search-block-wp")})]})]})})]})}})}},r={};function l(s){var n=r[s];if(void 0!==n)return n.exports;var a=r[s]={exports:{}};return e[s](a,a.exports,l),a.exports}l.m=e,s=[],l.O=(e,r,n,a)=>{if(!r){var i=1/0;for(p=0;p<s.length;p++){for(var[r,n,a]=s[p],o=!0,t=0;t<r.length;t++)(!1&a||i>=a)&&Object.keys(l.O).every(s=>l.O[s](r[t]))?r.splice(t--,1):(o=!1,a<i&&(i=a));if(o){s.splice(p--,1);var c=n();void 0!==c&&(e=c)}}return e}a=a||0;for(var p=s.length;p>0&&s[p-1][2]>a;p--)s[p]=s[p-1];s[p]=[r,n,a]},l.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),(()=>{var s={57:0,350:0};l.O.j=e=>0===s[e];var e=(e,r)=>{var n,a,[i,o,t]=r,c=0;if(i.some(e=>0!==s[e])){for(n in o)l.o(o,n)&&(l.m[n]=o[n]);if(t)var p=t(l)}for(e&&e(r);c<i.length;c++)a=i[c],l.o(s,a)&&s[a]&&s[a][0](),s[a]=0;return l.O(p)},r=globalThis.webpackChunkwordpress_plugin_search=globalThis.webpackChunkwordpress_plugin_search||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var n=l.O(void 0,[350],()=>l(961));n=l.O(n)})();