(()=>{"use strict";var s,e={961:()=>{const s=window.wp.blocks,e=window.wp.i18n,r=window.wp.blockEditor,l=window.wp.components,n=window.wp.element,a=window.wp.coreData,i=window.wp.data,t=window.ReactJSXRuntime,o=JSON.parse('{"UU":"telex/block-wordpress-plugin-search"}');(0,s.registerBlockType)(o.UU,{edit:function({attributes:s,setAttributes:o}){const{searchTerm:c,resultsPerPage:p,defaultSort:d,showFilters:h}=s,[u,w]=(0,n.useState)([]),[g,b]=(0,n.useState)(!0),[m,x]=(0,n.useState)(null),[_,j]=(0,n.useState)(!1),[v,k]=(0,n.useState)(null),[f,N]=(0,n.useState)(0),{restNonce:y}=(0,i.useSelect)(s=>{const{getCurrentUser:e}=s(a.store),r=e();return{restNonce:r?.meta?.rest_nonce||window.wpApiSettings?.nonce}},[]);(0,n.useEffect)(()=>{(async()=>{try{b(!0),x(null);const s=new URLSearchParams({action:"query_plugins",browse:"newest"===d?"new":"updated"===d?"updated":"popular",per_page:"6"}),e=await fetch(`/wp-json/wordpress-plugin-search/v1/query?${s}`,{headers:{"Content-Type":"application/json",...y&&{"X-WP-Nonce":y}}});if(!e.ok)throw new Error(`Failed to load plugins: ${e.status}`);{const s=await e.json();if(s.plugins&&Array.isArray(s.plugins)){const e=s.plugins.map(s=>{if(s.slug){s.screenshots=[];for(let e=1;e<=5;e++)s.screenshots.push({id:e,url:`https://ps.w.org/${s.slug}/assets/screenshot-${e}.png`});s.primaryScreenshot=s.screenshots[0]?.url}return s});w(e)}}}catch(s){console.error("Error loading preview data:",s),x(s.message),w([])}finally{b(!1)}})()},[y,d]);const S=[{label:(0,e.__)("Most Popular","wordpress-plugin-search-block-wp"),value:"popular"},{label:(0,e.__)("Highest Rated","wordpress-plugin-search-block-wp"),value:"rating"},{label:(0,e.__)("Most Installs","wordpress-plugin-search-block-wp"),value:"installs"},{label:(0,e.__)("Recently Updated","wordpress-plugin-search-block-wp"),value:"updated"},{label:(0,e.__)("Newest","wordpress-plugin-search-block-wp"),value:"newest"}],C=(s,e=0)=>{s.screenshots&&0!==s.screenshots.length&&(k(s),N(e),j(!0))},P=s=>{if(!v?.screenshots)return;let e=f+s;e<0?e=v.screenshots.length-1:e>=v.screenshots.length&&(e=0),N(e)},O=s=>s.screenshots&&0!==s.screenshots.length?(0,t.jsxs)("div",{className:"wps-screenshot-slider",children:[(0,t.jsx)("div",{className:"wps-main-screenshot",onClick:()=>C(s,0),style:{cursor:"zoom-in"},children:(0,t.jsx)("img",{src:s.primaryScreenshot,alt:`${s.name} screenshot`,loading:"lazy",onError:s=>{s.target.style.display="none",s.target.parentNode.innerHTML='<div class="wps-no-screenshot"><span class="dashicons dashicons-format-image"></span><span>No screenshots available</span></div>'}})}),(0,t.jsx)("div",{className:"wps-screenshot-thumbs",children:s.screenshots.slice(0,5).map((e,r)=>(0,t.jsx)("div",{className:"wps-screenshot-thumb "+(0===r?"active":""),onClick:()=>C(s,r),style:{cursor:"pointer"},children:(0,t.jsx)("img",{src:e.url,alt:`Screenshot ${e.id}`,loading:"lazy",onError:s=>{s.target.parentNode.style.display="none"}})},e.id))})]}):(0,t.jsxs)("div",{className:"wps-no-screenshot",children:[(0,t.jsx)("span",{className:"dashicons dashicons-format-image"}),(0,t.jsx)("span",{children:"No screenshots available"})]});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.InspectorControls,{children:(0,t.jsxs)(l.PanelBody,{title:(0,e.__)("Search Settings","wordpress-plugin-search-block-wp"),initialOpen:!0,children:[(0,t.jsx)(l.TextControl,{label:(0,e.__)("Default Search Term","wordpress-plugin-search-block-wp"),value:c,onChange:s=>o({searchTerm:s}),help:(0,e.__)("Pre-populate the search field with this term","wordpress-plugin-search-block-wp")}),(0,t.jsx)(l.SelectControl,{label:(0,e.__)("Default Sort Order","wordpress-plugin-search-block-wp"),value:d,options:S,onChange:s=>o({defaultSort:s}),help:(0,e.__)("Choose how plugins are sorted by default","wordpress-plugin-search-block-wp")}),(0,t.jsx)(l.SelectControl,{label:(0,e.__)("Results Per Page","wordpress-plugin-search-block-wp"),value:p,options:[{label:"12",value:12},{label:"24",value:24},{label:"48",value:48}],onChange:s=>o({resultsPerPage:parseInt(s)})}),(0,t.jsx)(l.ToggleControl,{label:(0,e.__)("Show Filters","wordpress-plugin-search-block-wp"),checked:h,onChange:s=>o({showFilters:s}),help:(0,e.__)("Display advanced filtering options to users","wordpress-plugin-search-block-wp")})]})}),(0,t.jsxs)("div",{...(0,r.useBlockProps)({className:"wps-search-block"}),children:[(0,t.jsxs)("div",{className:"wps-search-block__header",children:[(0,t.jsx)("h2",{className:"wps-search-block__title",children:(0,e.__)("WordPress Plugin Search","wordpress-plugin-search-block-wp")}),(0,t.jsx)("p",{className:"wps-search-block__description",children:(0,e.__)("Search and discover plugins with advanced sorting and filtering.","wordpress-plugin-search-block-wp")})]}),(0,t.jsxs)("div",{className:"wps-search-block__controls",children:[(0,t.jsxs)("div",{className:"wps-search-input",children:[(0,t.jsx)("input",{type:"text",placeholder:(0,e.__)("Search plugins...","wordpress-plugin-search-block-wp"),value:c,disabled:!0,readOnly:!0}),(0,t.jsx)("button",{type:"button",disabled:!0,children:(0,e.__)("Search","wordpress-plugin-search-block-wp")})]}),h&&(0,t.jsx)("div",{className:"wps-filter-controls",children:(0,t.jsxs)("div",{className:"wps-filter-row",children:[(0,t.jsxs)("div",{className:"wps-filter-item",children:[(0,t.jsx)("label",{children:(0,e.__)("Sort by","wordpress-plugin-search-block-wp")}),(0,t.jsx)("select",{disabled:!0,children:(0,t.jsx)("option",{children:S.find(s=>s.value===d)?.label||"Most Popular"})})]}),(0,t.jsxs)("div",{className:"wps-filter-item",children:[(0,t.jsx)("label",{children:(0,e.__)("Category","wordpress-plugin-search-block-wp")}),(0,t.jsx)("select",{disabled:!0,children:(0,t.jsx)("option",{children:(0,e.__)("All Categories","wordpress-plugin-search-block-wp")})})]}),(0,t.jsxs)("div",{className:"wps-filter-item",children:[(0,t.jsx)("label",{children:(0,e.__)("Min Rating","wordpress-plugin-search-block-wp")}),(0,t.jsx)("select",{disabled:!0,children:(0,t.jsx)("option",{children:(0,e.__)("Any Rating","wordpress-plugin-search-block-wp")})})]}),(0,t.jsxs)("div",{className:"wps-filter-item",children:[(0,t.jsx)("label",{children:(0,e.__)("Max Installs","wordpress-plugin-search-block-wp")}),(0,t.jsx)("select",{disabled:!0,children:(0,t.jsx)("option",{children:(0,e.__)("Any Amount","wordpress-plugin-search-block-wp")})})]})]})})]}),(0,t.jsxs)("div",{className:"wps-search-block__results",children:[m&&(0,t.jsxs)(l.Notice,{status:"error",isDismissible:!1,children:[(0,e.__)("Error loading plugins:","wordpress-plugin-search-block-wp")," ",m]}),g?(0,t.jsxs)("div",{className:"wps-loading",children:[(0,t.jsx)(l.Spinner,{}),(0,t.jsx)("p",{children:(0,e.__)("Loading plugins...","wordpress-plugin-search-block-wp")})]}):(0,t.jsx)("div",{className:"wps-plugin-grid",children:u.length>0?u.map((s,e)=>{if(!s||!s.name)return null;const r=s.rating?Math.round(s.rating/20):0,l="★".repeat(r)+"☆".repeat(5-r);return(0,t.jsxs)("div",{className:"wps-plugin-item",children:[O(s),(0,t.jsxs)("div",{className:"wps-plugin-info",children:[(0,t.jsx)("h3",{className:"wps-plugin-title",children:s.name}),(0,t.jsxs)("div",{className:"wps-plugin-meta",children:[s.rating&&(0,t.jsxs)("div",{className:"wps-plugin-rating",children:[(0,t.jsx)("span",{className:"wps-rating-stars",children:l}),(0,t.jsxs)("span",{className:"wps-rating-text",children:["(",s.num_ratings||0,")"]})]}),s.active_installs&&(0,t.jsxs)("div",{className:"wps-plugin-installs",children:[s.active_installs.toLocaleString(),"+ installs"]})]})]})]},s.slug||e)}):(0,t.jsx)("p",{className:"wps-no-results",children:(0,e.__)("No plugins found. This is a preview in the editor.","wordpress-plugin-search-block-wp")})})]}),(0,t.jsx)("div",{className:"wps-search-block__footer",children:(0,t.jsx)("p",{className:"wps-editor-note",children:(0,e.__)("This is an editor preview. Full search, filtering, and screenshot viewing will work on the front end.","wordpress-plugin-search-block-wp")})})]}),_&&v&&(0,t.jsx)(l.Modal,{title:v.name,onRequestClose:()=>{j(!1),k(null),N(0)},isFullScreen:!1,size:"large",className:"wps-screenshot-modal",children:(0,t.jsxs)("div",{style:{padding:"1rem",textAlign:"center"},children:[v.screenshots&&v.screenshots[f]&&(0,t.jsx)("img",{src:v.screenshots[f].url,alt:`${v.name} screenshot ${f+1}`,style:{maxWidth:"100%",maxHeight:"70vh",height:"auto",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}),v.screenshots&&v.screenshots.length>1&&(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"1rem",padding:"0 1rem"},children:[(0,t.jsx)(l.Button,{isSecondary:!0,onClick:()=>P(-1),disabled:0===f,children:(0,e.__)("Previous","wordpress-plugin-search-block-wp")}),(0,t.jsxs)("span",{style:{color:"#666",fontSize:"0.9rem"},children:[f+1," /"," ",v.screenshots.length]}),(0,t.jsx)(l.Button,{isSecondary:!0,onClick:()=>P(1),disabled:f===v.screenshots.length-1,children:(0,e.__)("Next","wordpress-plugin-search-block-wp")})]})]})})]})}})}},r={};function l(s){var n=r[s];if(void 0!==n)return n.exports;var a=r[s]={exports:{}};return e[s](a,a.exports,l),a.exports}l.m=e,s=[],l.O=(e,r,n,a)=>{if(!r){var i=1/0;for(p=0;p<s.length;p++){for(var[r,n,a]=s[p],t=!0,o=0;o<r.length;o++)(!1&a||i>=a)&&Object.keys(l.O).every(s=>l.O[s](r[o]))?r.splice(o--,1):(t=!1,a<i&&(i=a));if(t){s.splice(p--,1);var c=n();void 0!==c&&(e=c)}}return e}a=a||0;for(var p=s.length;p>0&&s[p-1][2]>a;p--)s[p]=s[p-1];s[p]=[r,n,a]},l.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),(()=>{var s={57:0,350:0};l.O.j=e=>0===s[e];var e=(e,r)=>{var n,a,[i,t,o]=r,c=0;if(i.some(e=>0!==s[e])){for(n in t)l.o(t,n)&&(l.m[n]=t[n]);if(o)var p=o(l)}for(e&&e(r);c<i.length;c++)a=i[c],l.o(s,a)&&s[a]&&s[a][0](),s[a]=0;return l.O(p)},r=globalThis.webpackChunkwordpress_plugin_search=globalThis.webpackChunkwordpress_plugin_search||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var n=l.O(void 0,[350],()=>l(961));n=l.O(n)})();